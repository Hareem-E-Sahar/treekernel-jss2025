library(dplyr)
library(ggplot2)
library(tidyr)
tfidf<-read.csv("~/treekernel-jss2025/results_final/RQ2/tfidf/metrics_RQ2_TF-IDF.csv",header=FALSE, skip = 1)
colnames(tfidf)<-c("Prec@5","Prec@10", "MRR","MAP","kernel","time","seed","type")
tfidf    <- tfidf%>%select (1,2,3,4,5,8)     #Prec@5, Prec@10, MRR, MAP, kernel, type
long_data <- tfidf %>%
pivot_longer(cols = c(`Prec@5`, `Prec@10`, MRR, MAP),
names_to = "Metric",
values_to = "Value")
result <- long_data %>%
group_by(kernel, type, Metric) %>%
summarise(Mean_Value = mean(Value, na.rm = TRUE), .groups = "drop")
latex_df <- result %>%
pivot_wider(
names_from  = Metric,
values_from = Mean_Value
)%>%
select(kernel, type, `Prec@5`, `Prec@10`, MRR, MAP)
# TF-IDF T1       0.52     0.43 0.85 0.83
# TF-IDF T2       0.22     0.14 0.53 0.47
# TF-IDF T3       0.19     0.16 0.34 0.17
#Precision@5,Precision@10,MRR,MAP@100,MAP,experiment,time,notes1,notes2,,notes3
codebert <- read.csv("~/treekernel-jss2025/results/codebert-metrics.csv", header=FALSE, skip = 1)
codebert <-codebert %>% select(1,2,3,4,5,6,7)
colnames(codebert)<-c("Prec@5","Prec@10","MRR","MAP@100","MAP","type","time") #experiment is renamed type for RQ2
codebert_rq2 <- codebert %>% select(1,2,3,4,6) #(MAP@100 but renamed to MAP)
colnames(codebert_rq2) <- c("Prec@5",	"Prec@10", "MRR",	"MAP", "type")
codebert_rq2$kernel <- "Codebert"
long_data <- codebert_rq2 %>%
pivot_longer(cols = c(`Prec@5`, `Prec@10`, MRR, MAP),
names_to = "Metric",
values_to = "Value")
result <- long_data %>%
group_by(kernel, type, Metric) %>%
summarise(Mean_Value = mean(Value, na.rm = TRUE), .groups = "drop")
latex_df <- result %>%
pivot_wider(
names_from  = Metric,
values_from = Mean_Value
)%>%
select(kernel, type, `Prec@5`, `Prec@10`, MRR, MAP)
library(xtable)
xtable(latex_df)
# 1 Codebert ST3-VST3                    0.242     0.236 0.255 0.170
# 2 Codebert T1                          0.571     0.465 0.848 0.831
# 3 Codebert T2                          0.221     0.152 0.350 0.407
# 4 Codebert T3                          0.345     0.362 0.319 0.133
# 5 Codebert high_complexity_positive    0.361     0.325 0.434 0.122
# 6 Codebert large_method_positive       0.405     0.373 0.441 0.119
# 7 Codebert low_complexity_positive     0.475     0.456 0.471 0.182
# 8 Codebert rq1-pos                     0.489     0.460 0.505 0.184
# 9 Codebert small_method_positive       0.751     0.756 0.72  0.534
library(dplyr)
library(ggplot2)
library(tidyr)
tfidf<-read.csv("~/treekernel-jss2025/results_final/RQ2/tfidf/metrics_RQ2_TF-IDF.csv",header=FALSE, skip = 1)
colnames(tfidf)<-c("Prec@5","Prec@10", "MRR","MAP","kernel","time","seed","type")
tfidf    <- tfidf%>%select (1,2,3,4,5,8)     #Prec@5, Prec@10, MRR, MAP, kernel, type
long_data <- tfidf %>%
pivot_longer(cols = c(`Prec@5`, `Prec@10`, MRR, MAP),
names_to = "Metric",
values_to = "Value")
result <- long_data %>%
group_by(kernel, type, Metric) %>%
summarise(Mean_Value = mean(Value, na.rm = TRUE), .groups = "drop")
latex_df <- result %>%
pivot_wider(
names_from  = Metric,
values_from = Mean_Value
)%>%
select(kernel, type, `Prec@5`, `Prec@10`, MRR, MAP)
latex_df
library(xtable)
xtable(latex_df)
library(dplyr)
library(ggplot2)
library(tidyr)
#topk
filecols <- c("Prec@5","Prec@10","MRR","MAP","kernel","time","seed","mode")
read_metrics <- function(path, type, filter) {
df <- read.csv(path, header = FALSE)
colnames(df) <- filecols
df <- df[df$mode == "normalized", ]
df$type   <- type
df$filter <- filter
return(df)
}
ptkT1_topk <- read_metrics(
"~/treekernel-jss2025/results_final/RQ2/T1/metrics_RQ2_T1_PTK_topk.csv",
type   = "T1",
filter = "topk"
)
sstkT1_topk <- read_metrics(
"~/treekernel-jss2025/results_final/RQ2/T1/metrics_RQ2_T1_SSTK_topk.csv",
type   = "T1",
filter = "topk"
)
stkT1_topk <- read_metrics(
"~/treekernel-jss2025/results_final/RQ2/T1/metrics_RQ2_T1_STK_topk.csv",
type   = "T1",
filter = "topk"
)
ptkT2_topk <- read_metrics(
"~/treekernel-jss2025/results_final/RQ2/T2/metrics_RQ2_T2_PTK_topk.csv",
type   = "T2",
filter = "topk"
)
sstkT2_topk <- read_metrics(
"~/treekernel-jss2025/results_final/RQ2/T2/metrics_RQ2_T2_SSTK_topk.csv",
type   = "T2",
filter = "topk"
)
stkT2_topk <- read_metrics(
"~/treekernel-jss2025/results_final/RQ2/T2/metrics_RQ2_T2_STK_topk.csv",
type   = "T2",
filter = "topk"
)
ptkT3_topk <- read_metrics(
"~/treekernel-jss2025/results_final/RQ2/T3/metrics_RQ2_T3_PTK_topk.csv",
type   = "T3",
filter = "topk"
)
sstkT3_topk <- read_metrics(
"~/treekernel-jss2025/results_final/RQ2/T3/metrics_RQ2_T3_SSTK_topk.csv",
type   = "T3",
filter = "topk"
)
stkT3_topk <- read_metrics(
"~/treekernel-jss2025/results_final/RQ2/T3/metrics_RQ2_T3_STK_topk.csv",
type   = "T3",
filter = "topk"
)
#round(sapply(cols, function(col) mean(sstkT1_topk[[col]])),2)
#round(sapply(cols, function(col) mean(ptkT1_topk[[col]])),2)
library(dplyr)
topk_all <- bind_rows(
ptkT1_topk, sstkT1_topk, stkT1_topk,
ptkT2_topk, sstkT2_topk, stkT2_topk,
ptkT3_topk, sstkT3_topk, stkT3_topk
)
long_data_topk <- topk_all %>%
pivot_longer(cols = c(`Prec@5`, `Prec@10`, MRR, MAP),
names_to = "Metric",
values_to = "Value")
result <- long_data_topk %>%
group_by(kernel, filter, type, Metric) %>%
summarise(Mean_Value = mean(Value, na.rm = TRUE), .groups = "drop")
latex_df <- result %>%
pivot_wider(
names_from  = Metric,
values_from = Mean_Value
)%>%
select(kernel, type, `Prec@5`, `Prec@10`, MRR, MAP)
library(xtable)
xtable(latex_df)
# kernel type  `Prec@5` `Prec@10`   MRR   MAP
# 1 PTK    T1       0.598     0.483 0.972 0.946
# 2 PTK    T2       0.242     0.159 0.629 0.632
# 3 PTK    T3       0.320     0.280 0.465 0.266
# 4 SSTK   T1       0.598     0.483 0.972 0.946
# 5 SSTK   T2       0.238     0.158 0.621 0.625
# 6 SSTK   T3       0.234     0.208 0.344 0.167
# 7 STK    T1       0.544     0.444 0.881 0.900
# 8 STK    T2       0.294     0.218 0.686 0.630
# 9 STK    T3       0.295     0.250 0.474 0.238
library(dplyr)
library(ggplot2)
library(tidyr)
tfidf<-read.csv("~/treekernel-jss2025/results_final/RQ2/tfidf/metrics_RQ2_TF-IDF.csv",header=FALSE, skip = 1)
colnames(tfidf)<-c("Prec@5","Prec@10", "MRR","MAP","kernel","time","seed","type")
tfidf    <- tfidf%>%select (1,2,3,4,5,8)     #Prec@5, Prec@10, MRR, MAP, kernel, type
long_data <- tfidf %>%
pivot_longer(cols = c(`Prec@5`, `Prec@10`, MRR, MAP),
names_to = "Metric",
values_to = "Value")
result <- long_data %>%
group_by(kernel, type, Metric) %>%
summarise(Mean_Value = mean(Value, na.rm = TRUE), .groups = "drop")
latex_df <- result %>%
pivot_wider(
names_from  = Metric,
values_from = Mean_Value
)%>%
select(kernel, type, `Prec@5`, `Prec@10`, MRR, MAP)
library(xtable)
xtable(latex_df)
# TF-IDF T1       0.52     0.43 0.85 0.83
# TF-IDF T2       0.22     0.14 0.53 0.47
# TF-IDF T3      0.21      0.17 0.38 0.19
#Precision@5,Precision@10,MRR,MAP@100,MAP,experiment,time,notes1,notes2,,notes3
codebert <- read.csv("~/treekernel-jss2025/results/codebert-metrics.csv", header=FALSE, skip = 1)
codebert <-codebert %>% select(1,2,3,4,5,6,7)
colnames(codebert)<-c("Prec@5","Prec@10","MRR","MAP@100","MAP","type","time") #experiment is renamed type for RQ2
codebert_rq2 <- codebert %>% select(1,2,3,4,6) #(MAP@100 but renamed to MAP)
colnames(codebert_rq2) <- c("Prec@5",	"Prec@10", "MRR",	"MAP", "type")
codebert_rq2$kernel <- "Codebert"
long_data <- codebert_rq2 %>%
pivot_longer(cols = c(`Prec@5`, `Prec@10`, MRR, MAP),
names_to = "Metric",
values_to = "Value")
result <- long_data %>%
group_by(kernel, type, Metric) %>%
summarise(Mean_Value = mean(Value, na.rm = TRUE), .groups = "drop")
latex_df <- result %>%
pivot_wider(
names_from  = Metric,
values_from = Mean_Value
)%>%
select(kernel, type, `Prec@5`, `Prec@10`, MRR, MAP)
library(xtable)
xtable(latex_df)
# 1 Codebert ST3-VST3                    0.242     0.236 0.255 0.170
# 2 Codebert T1                          0.571     0.465 0.848 0.831
# 3 Codebert T2                          0.221     0.152 0.350 0.407
# 4 Codebert T3                          0.345     0.362 0.319 0.133
# 5 Codebert high_complexity_positive    0.361     0.325 0.434 0.122
# 6 Codebert large_method_positive       0.405     0.373 0.441 0.119
# 7 Codebert low_complexity_positive     0.475     0.456 0.471 0.182
# 8 Codebert rq1-pos                     0.489     0.460 0.505 0.184
# 9 Codebert small_method_positive       0.751     0.756 0.72  0.534
source("~/treekernel-jss2025/plots/rq2/RQ2-topk.R")
#source("~/treekernel-jss2025/plots/rq2/RQ2-threshold.R")
#source("~/treekernel-jss2025/plots/rq2/RQ2-topk-threshold.R")
#source("~/treekernel-jss2025/plots/rq2/RQ2-no-filter.R")
source("~/treekernel-jss2025/plots/rq2/RQ2-load-baseline-metrics.R")
tfidf_type1 <- tfidf %>% filter(type == "T1")
tfidf_type2 <- tfidf %>% filter(type == "T2")
tfidf_type3 <- tfidf %>% filter(type == "T3")
codebert_type1 <- codebert_rq2 %>% filter(type == "T1")
codebert_type2 <- codebert_rq2 %>% filter(type == "T2")
codebert_type3 <- codebert_rq2 %>% filter(type == "T3")
combined_typedata <- bind_rows(topk_all, tfidf_type1, tfidf_type2, tfidf_type3, codebert_type1, codebert_type2, codebert_type3)
long_data_tfidf_codebert <- combined_typedata %>%
pivot_longer(cols = c(`Prec@5` ,`Prec@10`, MRR, MAP),
names_to = "Metric",
values_to = "Value")
rq2_topk <- ggplot(long_data_tfidf_codebert, aes(x = type, y = Value, fill = kernel)) +
geom_boxplot() +
facet_wrap(~ Metric, scales = "free_y") +  # Facet by Metric
labs(  x = "",y = "") +
scale_fill_manual(values = c("PTK" = "lightblue", "SSTK" = "lightgreen","STK" = "gray",
"TF-IDF"="pink","Codebert"="khaki1" )) +
theme_minimal() +
theme(legend.title = element_blank(),legend.position = "top")
ggsave("~/treekernel-jss2025/plots/rq2/rq2-topk.pdf", rq2_topk, width=5.5,height=6)
